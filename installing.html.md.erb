---
title: Installing File Integrity Monitoring
owner: Security Engineering
---

<strong><%= modified_date %></strong>

This topic describes how to install <%= vars.product_full %>
(<%= vars.product_abbr %>) on your deployment.

##<a id="prereqs"></a>Prerequisites

<p class="note warning"><strong>Warning: </strong>FIM Add-on on Windows is in Beta.
</p>

To complete the <%= vars.product_abbr %> installation:

* You must be a <%= vars.platform_name %> operator with admin rights.
See [Operators](https://docs.pivotal.io/pivotalcf/customizing/user-types.html#operator)
in the <%= vars.platform_name %> documentation.

* You must have <%= vars.ops_manager_full %> v2.3 or later.

##<a id="create-mfest-linux"></a>Create the <%= vars.product_abbr %> Manifest (Linux)

The <%= vars.product_abbr %> runtime configuration file is a YAML file that contains runtime configuration
information for the <%= vars.product_abbr %>.
Follow the steps below to create the <%= vars.product_abbr %> runtime configuration for your Linux deployment:

1. Create a file named `fim.yml`, using the following code as a template.

    ```
    releases:
    - name: fim
      version: X.X.X
    addons:
    - name: fim-trusty
      jobs:
      - name: fim
        release: fim
        properties: {}
      include:
        stemcell:
        - os: ubuntu-trusty
    - name: fim-xenial
      jobs:
      - name: fim
        release: fim
        properties:
          fim:
            dirs:
              # System binaries and configuration
              - /boot/grub
              - /root
              - /bin
              - /etc
              - /lib
              - /lib32 # xenial-specific
              - /lib64
              - /opt
              - /sbin
              - /srv
              - /usr
              - /var/lib

              # Bosh agent
              - /var/vcap/bosh
              - /var/vcap/monit/job

              # Bosh releases
              - /var/vcap/data/packages
              - /var/vcap/data/jobs
      include:
        stemcell:
        - os: ubuntu-xenial
    ```

2. (Optional) Set the properties `cpu_limit`, `enforce_cpu_limit`, `memory_limit`, and  `heartbeat_interval`.
To use these properties, place this text under the `fim` subsection of `fim.yml`:

    ```
    ...
    properties:
      fim:
        cpu_limit: VALUE-OF-CPU-LIMIT
        enforce_cpu_limit: TRUE|FALSE
        memory_limit: VALUE-OF-MEMORY-LIMIT-IN-BYTES
        heartbeat_interval: VALUE-OF-HEARTBEAT-INTERVAL
    ...
    ```
  <code><strong>cpu\_limit</strong></code>: <a name="cpu_limit"></a>
    <ul>
      <li>
        Limits <%= vars.product_abbr %> to a percentage of available CPU
        resources when other processes use CPU resources.
        Usage can exceed the limit if enough idle CPU cycles are available.
      </li>
      <li>
        Must be set to a whole number less than 100.
        For example, set it to <code>50</code> to limit <%= vars.product_abbr %>
         to 50% CPU usage when other tasks are running.
       </li>
        <li>
          The default value is <code>10</code>.
        </li>
    </ul>

    <code><strong>enforce\_cpu\_limit</strong></code>: <a name="enforce_cpu_limit"></a>
    <ul>
      <li>When <code>true</code>, the limit set by <code>cpu\_limit</code> is always enforced.</li>
      <li>When <code>false</code>, the limit set by <code>cpu\_limit</code> is
        only enforced when other processes use CPU resources.
        Usage can exceed the limit if enough idle CPU cycles are available.</li>
        <li>This property is <code>false</code> by default.</li>
        <p class="note warning"><strong>Warning: </strong> If <code>enforce\_cpu\_limit</code> is set <code>true</code>,
        verify that <code>cpu_limit</code> is set high enough for FIM to execute normally.
        If the limit is too strict, FIM fails to start.
        </p>

    </ul>

    <code><strong>memory\_limit</strong></code>: <a name="memory_limit"></a>
    <ul>
      <li>Limits the maximum amount of user memory (including file cache) in bytes used by <%= vars.product_abbr %>.</li>
      <li>Has the default value <code>536870912</code>.</li>
    </ul>

    <code><strong>heartbeat\_interval</strong></code>: <a name="heartbeat_interval"></a>
    <ul>
      <li>To enable the heartbeat interval, set this value to an integer greater than <code>0</code> .
        If you set a negative value, an error occurs. </li>
      <li>To disable the heartbeat interval, set this value to <code>0</code>.</li>
      <li>The default value is <code>600</code>. </li>
    </ul>


##<a id="create-mfest-windows"></a>Create the <%= vars.product_abbr %> Manifest (Windows) (BETA)

The FIM runtime configuration file is a YAML file that contains runtime configuration
information for <%= vars.product_abbr %>.
Follow the steps below to create the <%= vars.product_abbr %> runtime configuration for your Windows deployment:

1. Create a file named `fim.yml`, using the following code as a template.

    ```
    releases:
    - name: fim
      version: X.X.X
    addons:
    - name: fim-windows
      jobs:
      - name: fim-windows
        release: fim
        properties:
          fim:
            dirs:
            - C:\Windows\System32
            - C:\Program Files
            - C:\Program Files (x86)
            - C:\var\vcap\bosh
            - C:\var\vcap\data\packages
            - C:\var\vcap\data\jobs
      include:
        stemcell:
        - os: windows2019
        - os: windows2016
        - os: windows2012R2
        - os: windows1803
    ```

2. (Optional) Set the property `heartbeat_interval`.
To use this property, place this text under the `fim` subsection of `fim.yml`:

    ```
    ...
    properties:
      fim:
        heartbeat_interval: VALUE-OF-HEARTBEAT-INTERVAL
    ...
    ```
    <code><strong>heartbeat\_interval</strong></code>: <a name="heartbeat_interval_windows"></a>
    <ul>
      <li>To enable the heartbeat interval, set this value to an integer greater than <code>0</code> .
        If you set a negative value, an error occurs. </li>
      <li>To disable the heartbeat interval, set this value to <code>0</code>.</li>
      <li>The default value is <code>600</code>. </li>
    </ul>

##<a id="download"></a>Download <%= vars.product_abbr %>

To download the <%= vars.product_abbr %> software binary file and move it to your <%= vars.ops_manager %>
VM, follow the steps below:

1. Download the <%= vars.product_abbr %> software binary file from
[Pivotal Network](https://network.pivotal.io/products/p-fim-addon) to your local machine.

2. Copy the binary file to your <%= vars.ops_manager %> VM by running:

    ```
    scp -i PATH-TO-PRIVATE-KEY fim-release.tgz ubuntu@YOUR-OPS-MANAGER-VM-IP:
    ```
    For example:

    <pre class="terminal">$ scp -i ~/.ssh/my-key.pem fim-1.2.23.tar.gz ubuntu@192.0.2.0:</pre>

3. Copy the <%= vars.product_abbr %> runtime configuration `fim.yml` file to your <%= vars.ops_manager %> instance by running:

    ```
    scp -i PATH-TO-PRIVATE-KEY fim.yml ubuntu@YOUR-OPS-MANAGER-VM-IP:
    ```

    For example:

    <pre class="terminal">$ scp -i ~/.ssh/my-key.pem fim.yml ubuntu@192.0.2.0:</pre>

4. [Log in to the <%= vars.ops_manager %> VM with SSH](https://docs.pivotal.io/pivotalcf/customizing/trouble-advanced.html#ssh).

5. Navigate to the location of the binary file on the <%= vars.ops_manager %> VM by running:

    ```
    cd PATH-TO-BINARY-FILE
    ```

    For example:

    <pre class="terminal">$ cd ~</pre>

##<a id="deploy"></a> Deploy <%= vars.product_abbr %>

Perform these steps to deploy <%= vars.product_abbr %>:

1. Upload your release, specifying the path to the tarballed <%= vars.product_abbr %> binary file, by running:

    ```
    bosh -e BOSH-ENVIRONMENT upload-release PATH-TO-NEW-FIM-RELEASE
    ```

    For example:

    <pre class="terminal">$ bosh -e my-env upload-release fim-1.2.23.tar.gz</pre>

1. <a name="update"></a>Update your runtime configuration to include <%= vars.product_abbr %>,
   specifying the path to the `fim.yml` file you created earlier, by running:

    ```
    bosh -e BOSH-ENVIRONMENT update-runtime-config --name=fim /tmp/fim.yml
    ```

    For example:

    <pre class="terminal">$ bosh -e my-env update-runtime-config --name=fim fim.yml</pre>

    <p class="note"><strong>Note</strong>: If you installed other BOSH add-ons,
    you must merge the <%= vars.product_abbr %> runtime configuration into your existing add-on runtime configuration.
    Append the contents of <code>fim.yml</code> to your existing add-on YAML file.
    </p>

1. Verify that your runtime configuration changes match what you specified in the manifest file.

    ```
    bosh -e BOSH-ENVIRONMENT runtime-config --name fim
    ```

    For example:
    <pre class="terminal">
    $ bosh -e my-env runtime-config --name=fim
    </pre>

    This command returns your updated <%= vars.product_abbr %> runtime configuration.

    For example:
    <pre class="terminal">
    Acting as user 'admin' on 'micro'
    releases:
    <span>-</span> name: fim
      version: 1.2.23
    addons:
      name: fim
        jobs:
        <span>-</span> name: fim
          release: fim
    ...
    </pre>

1. Navigate to the **Installation Dashboard** in <%= vars.ops_manager %>.

1. Click **Review Pending Changes**.

1. Click **Apply Changes**.

##<a id="alerts"></a> Configure Forwarding for <%= vars.product_abbr %> Alerts

The <%= vars.product_abbr %> BOSH release writes all alerts to the syslogs of the VMs in your deployment.
You can use syslog forwarding to forward the alerts to a syslog aggregator.

* **Using the <%= vars.app_runtime_full %> (<%= vars.app_runtime_abbr %>) tile**:
Follow the steps to configure system logging in <%= vars.app_runtime_abbr %> in [Configuring Logging in <%= vars.app_runtime_abbr %>](https://docs.pivotal.io/pivotalcf/2-4/opsguide/logging-config-opsman.html).
The syslog aggregator that you specify receives all alerts generated on <%= vars.app_runtime_abbr %> VMs, including the <%= vars.product_abbr %> alerts.
* **Using the syslog BOSH release**: You can use the syslog BOSH release to forward system logs.
See [syslog-release](https://github.com/cloudfoundry/syslog-release) in GitHub for instructions.

<p class="note"><strong>Note</strong>: When you configure syslog forwarding, ensure there is enough disk space for the logs.
Ensure that the log rotation is frequent enough. If in doubt, rotate the logs hourly or when they reach a certain size.
Pivotal recommends forwarding logs to a remote syslog aggregation system.
</p>

## <a id="verify"></a>Verify the Installation

1. Run `bosh instances --ps` and look for the deployment.
  1. For Linux, validate by checking that there is a `fim` process in the `running` state:

        ```
        Deployment 'fim-xenial'

        Instance                                    Process  Process State  AZ  IPs
        fim_1/8cec18fa-b1a0-4d30-bbe5-a522c12ca62e  -        running        z1  10.0.0.18
        ~                                           fim      running        -   -

        1 instances
        ```

  1. For Windows, validate by checking that there is a `filesnitch` process in the `running` state:

        ```
        Deployment 'fim-windows'

        Instance                                       Process     Process State  AZ  IPs
        fim_2/0d11b596-ce2a-4aa6-baaa-664a83fb72c3     -           running        z1  10.0.0.4
        ~                                              filesnitch  running        -   -

        1 instances
        ```

1. Verify that `fim` is logging. To do this, use `bosh ssh` to log in to one of
the VMs in your deployment with SSH. For more information, see
[BOSH SSH](https://docs.pivotal.io/pivotalcf/customizing/trouble-advanced.html#bosh-ssh).

  1. For Linux:

      1. Enter this command:

            ```
            touch /bin/hackertool
            ```

      1. Enter this command:

            ```
            grep hackertool /var/log/syslog
            ```

      1. Verify in the logs that a new file has been created. For example:
      <pre class="terminal">Sep 22 23:57:07 qvsfgv0qnrk filesnitch[3040]: CEF:0|cloud_foundry|fim|1.0.0|1|file integrity monitoring event|5| fname="/bin/hackertool" hostname="f98968fe-501a-470b-819a-c4a2a7ac45c8" opname="CREATE" optype=1 ts=1474588627</pre>

  1. For Windows (Beta):

      1. Enter this command:

            ```
            powershell New-Item -type File /var/vcap/data/jobs/sample_file
            ```

      1. Enter this command:

            ```
            powershell "Get-Content /var/vcap/sys/log/fim-windows/filesnitch/job-service-wrapper.out.log | Select-String sample_file"
            ```

      1. Verify in the logs that a new file has been created. For example:
      <pre class="terminal">CEF:0|cloud_foundry|fim|1.0.0|1|file integrity monitoring event|5| fname="C:\\var\\vcap\\data\\jobs\\sample_file" hostname="no-job_1/ebee34c1-3300-4f5d-9557-bbef845d608c" opname="CREATE" optype=1 ts=1569953512 severity=5</pre>
